# Copyright (c) 2016 Riverbank Computing Limited <info@riverbankcomputing.com>
#
# This file is part of SIP.
#
# This copy of SIP is licensed for use under the terms of the SIP License
# Agreement.  See the file LICENSE for more details.
#
# This copy of SIP may also used under the terms of the GNU General Public
# License v2 or v3 as published by the Free Software Foundation which can be
# found in the files LICENSE-GPL2 and LICENSE-GPL3 included in this package.
#
# SIP is supplied WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.


import distutils
import glob
import os
import sys

# Check the version of Python as early as possible.
if sys.hexversion < 0x03010000 and (sys.hexversion >= 0x03000000 or sys.hexversion < 0x02070000):
    sys.stderr.write("sip5 requires Python v3.1 or later or Python v2.7\n")
    sys.exit(1)


from setuptools import Extension, setup


# Get the long description for PyPI.
with open('README') as readme:
    long_description = readme.read()

# Build the sip module.
sip_module_src = glob.glob(os.path.join('siplib', '*.c')) + glob.glob(os.path.join('siplib', '*.cpp'))
sip_module = Extension('sip', sip_module_src, include_dirs=['siplib'])

ext_modules = [sip_module]
entry_points = {}
packages = []

if sys.hexversion >= 0x03000000:
    # Build the sip5 module.
    sip5_module_src = glob.glob(os.path.join('sipgen', '*.c'))
    sip5_module = Extension('sip5._sip', sip5_module_src,
            include_dirs=['sipgen'])

    ext_modules.append(sip_module)
    entry_points['console_scripts'] = ['sip5 = sip5.main:main']
    packages.append('sip5')

# Do the setup.
setup(
        name='sip5',
        version='@RM_RELEASE@',
        description="A Python module generator for wrapping C/C++ libraries",
        long_description=long_description,
        author='Riverbank Computing Limited',
        author_email='info@riverbankcomputing.com',
        url='http://www.riverbankcomputing.com/software/sip/',
        license='SIP',
        platforms=['Linux', 'OS X', 'Windows', 'iOS', 'Android'],
        packages=packages,
        entry_points=entry_points,
        ext_modules=ext_modules,
        data_files=[
                (distutils.sysconfig.get_python_inc(prefix=sys.prefix),
                        [os.path.join('siplib', 'sip.h')])],
        zip_safe=False
     )
